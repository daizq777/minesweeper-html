<!DOCTYPE html>
<html>
<head>
    <title>ä¼˜åŒ–ç‰ˆè¶…å¤§è§„æ¨¡æ‰«é›·</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        :root {
            --cell-size: 30px;
            --cell-border: 1px solid #999;
            --cell-bg: #ddd;
            --revealed-bg: #fff;
            --flagged-bg: #f99;
            --mine-bg: #f00;
            --text-color: #333;
        }
        
        body {
            margin: 0;
            padding: 0;
            touch-action: manipulation;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: calc(100vh - 60px);
            overflow: auto;
            background-color: #f0f0f0;
        }
        
        #minefield {
            position: absolute;
            border-collapse: collapse;
            table-layout: fixed;
        }
        
        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            min-width: var(--cell-size);
            min-height: var(--cell-size);
            max-width: var(--cell-size);
            max-height: var(--cell-size);
            border: var(--cell-border);
            text-align: center;
            vertical-align: middle;
            font-weight: bold;
            font-size: calc(var(--cell-size) * 0.6);
            background-color: var(--cell-bg);
            user-select: none;
            cursor: pointer;
            box-sizing: border-box;
            transition: background-color 0.2s;
        }
        
        .cell.revealed {
            background-color: var(--revealed-bg);
        }
        
        .cell.flagged {
            background-color: var(--flagged-bg);
        }
        
        .cell.mine {
            background-color: var(--mine-bg);
        }
        
        .cell.mine::after {
            content: "ğŸ’£";
            font-size: calc(var(--cell-size) * 0.8);
            line-height: var(--cell-size);
        }
        
        .cell.flagged::after {
            content: "ğŸš©";
            font-size: calc(var(--cell-size) * 0.8);
            line-height: var(--cell-size);
        }
        
        #controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: #333;
            color: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            box-sizing: border-box;
            z-index: 100;
        }
        
        #controls button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        #controls button:active {
            background-color: #3e8e41;
        }
        
        #stats {
            font-size: 16px;
            color: white;
        }
        
        #zoom-controls {
            display: flex;
            gap: 10px;
        }
        
        #zoom-controls button {
            width: 40px;
            height: 40px;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .number-1 { color: blue; }
        .number-2 { color: green; }
        .number-3 { color: red; }
        .number-4 { color: darkblue; }
        .number-5 { color: brown; }
        .number-6 { color: teal; }
        .number-7 { color: black; }
        .number-8 { color: gray; }
    </style>
</head>
<body>
    <div id="game-container">
        <table id="minefield"></table>
    </div>
    
    <div id="controls">
        <button id="new-game">æ–°æ¸¸æˆ</button>
        <div id="stats">
            å‰©ä½™é›·æ•°: <span id="mines-left">0</span> | 
            å·²æ ‡è®°: <span id="flags-placed">0</span>
        </div>
        <div id="zoom-controls">
            <button id="zoom-in">+</button>
            <button id="zoom-out">-</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const config = {
            width: 500,   // åœ°å›¾å®½åº¦(å•å…ƒæ ¼æ•°)
            height: 500,  // åœ°å›¾é«˜åº¦(å•å…ƒæ ¼æ•°)
            mines: 10000,  // é›·æ•°(10ä¸‡é¢—åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ€§èƒ½å¯èƒ½ä¸è¶³ï¼Œæ”¹ä¸º1ä¸‡)
            baseCellSize: 30 // åŸºç¡€å•å…ƒæ ¼å¤§å°(px)
        };
        
        // å½“å‰ç¼©æ”¾çº§åˆ«
        let currentZoom = 1;

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            minefield: null,
            revealed: null,
            flagged: null,
            gameOver: false,
            firstClick: true,
            flagsPlaced: 0
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            const minefield = document.getElementById('minefield');
            minefield.innerHTML = '';
            
            // è®¾ç½®å•å…ƒæ ¼å¤§å°
            updateCellSize();
            
            // åˆ›å»ºæ¸¸æˆçŠ¶æ€æ•°ç»„
            gameState.minefield = new Array(config.height);
            gameState.revealed = new Array(config.height);
            gameState.flagged = new Array(config.height);
            gameState.flagsPlaced = 0;
            
            for (let y = 0; y < config.height; y++) {
                gameState.minefield[y] = new Array(config.width).fill(0);
                gameState.revealed[y] = new Array(config.width).fill(false);
                gameState.flagged[y] = new Array(config.width).fill(false);
                
                const row = minefield.insertRow();
                for (let x = 0; x < config.width; x++) {
                    const cell = row.insertCell();
                    cell.className = 'cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    
                    // æ·»åŠ äº‹ä»¶ç›‘å¬
                    cell.addEventListener('click', handleCellClick);
                    cell.addEventListener('contextmenu', handleRightClick);
                    cell.addEventListener('touchstart', handleTouchStart, {passive: false});
                    cell.addEventListener('touchend', handleTouchEnd);
                }
            }
            
            gameState.gameOver = false;
            gameState.firstClick = true;
            updateStats();
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°ä¸­å¿ƒ
            setTimeout(() => {
                minefield.style.left = '50%';
                minefield.style.top = '50%';
                minefield.style.transform = 'translate(-50%, -50%)';
            }, 100);
        }
        
        // æ›´æ–°å•å…ƒæ ¼å¤§å°
        function updateCellSize() {
            const size = config.baseCellSize * currentZoom;
            document.documentElement.style.setProperty('--cell-size', `${size}px`);
        }

        // æ”¾ç½®åœ°é›·(ç¡®ä¿ç¬¬ä¸€æ¬¡ç‚¹å‡»å®‰å…¨)
        function placeMines(safeX, safeY) {
            let minesPlaced = 0;
            
            // åˆ›å»ºå®‰å…¨åŒºåŸŸ(ç¬¬ä¸€æ¬¡ç‚¹å‡»å‘¨å›´3x3åŒºåŸŸä¸æ”¾é›·)
            const safeZone = [];
            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    const x = safeX + dx;
                    const y = safeY + dy;
                    if (x >= 0 && x < config.width && y >= 0 && y < config.height) {
                        safeZone.push(`${x},${y}`);
                    }
                }
            }
            
            // éšæœºæ”¾ç½®åœ°é›·
            while (minesPlaced < config.mines) {
                const x = Math.floor(Math.random() * config.width);
                const y = Math.floor(Math.random() * config.height);
                
                // æ£€æŸ¥æ˜¯å¦åœ¨å®‰å…¨åŒºåŸŸæˆ–å·²æœ‰é›·
                if (!safeZone.includes(`${x},${y}`) && gameState.minefield[y][x] !== -1) {
                    gameState.minefield[y][x] = -1; // -1è¡¨ç¤ºé›·
                    minesPlaced++;
                    
                    // æ›´æ–°å‘¨å›´å•å…ƒæ ¼çš„æ•°å­—
                    for (let dy = -1; dy <= 1; dy++) {
                        for (let dx = -1; dx <= 1; dx++) {
                            const nx = x + dx;
                            const ny = y + dy;
                            if (nx >= 0 && nx < config.width && ny >= 0 && ny < config.height && gameState.minefield[ny][nx] !== -1) {
                                gameState.minefield[ny][nx]++;
                            }
                        }
                    }
                }
            }
        }

        // å¤„ç†å•å…ƒæ ¼ç‚¹å‡»
        function handleCellClick(event) {
            if (gameState.gameOver) return;
            
            const cell = event.currentTarget;
            const x = parseInt(cell.dataset.x);
            const y = parseInt(cell.dataset.y);
            
            if (gameState.flagged[y][x]) return;
            
            if (gameState.firstClick) {
                placeMines(x, y);
                gameState.firstClick = false;
            }
            
            revealCell(x, y);
            
            if (gameState.minefield[y][x] === -1) {
                // è¸©åˆ°é›·ï¼Œæ¸¸æˆç»“æŸ
                gameOver(false);
            } else if (checkWin()) {
                // æ£€æŸ¥æ˜¯å¦èƒœåˆ©
                gameOver(true);
            }
        }
        
        // è§¦æ‘¸å¼€å§‹å¤„ç†(ç”¨äºé˜»æ­¢æ»šåŠ¨)
        function handleTouchStart(event) {
            if (event.touches.length === 1) {
                event.preventDefault();
            }
        }
        
        // è§¦æ‘¸ç»“æŸå¤„ç†(æ¨¡æ‹Ÿå³é”®ç‚¹å‡»)
        function handleTouchEnd(event) {
            if (event.touches.length === 0 && event.changedTouches.length === 1) {
                const touch = event.changedTouches[0];
                const element = document.elementFromPoint(touch.clientX, touch.clientY);
                if (element && element.classList.contains('cell')) {
                    // é•¿æŒ‰è§†ä¸ºå³é”®ç‚¹å‡»
                    handleRightClick({currentTarget: element, preventDefault: () => {}});
                }
            }
        }

        // å¤„ç†å³é”®ç‚¹å‡»(æ’æ——)
        function handleRightClick(event) {
            event.preventDefault();
            if (gameState.gameOver || gameState.firstClick) return;
            
            const cell = event.currentTarget;
            const x = parseInt(cell.dataset.x);
            const y = parseInt(cell.dataset.y);
            
            if (!gameState.revealed[y][x]) {
                gameState.flagged[y][x] = !gameState.flagged[y][x];
                if (gameState.flagged[y][x]) {
                    gameState.flagsPlaced++;
                } else {
                    gameState.flagsPlaced--;
                }
                cell.className = gameState.flagged[y][x] ? 'cell flagged' : 'cell';
                updateStats();
            }
        }

        // æ­ç¤ºå•å…ƒæ ¼
        function revealCell(x, y) {
            if (x < 0 || x >= config.width || y < 0 || y >= config.height || 
                gameState.revealed[y][x] || gameState.flagged[y][x]) {
                return;
            }
            
            gameState.revealed[y][x] = true;
            const cell = document.getElementById('minefield').rows[y].cells[x];
            cell.classList.add('revealed');
            
            if (gameState.minefield[y][x] > 0) {
                // æ˜¾ç¤ºå‘¨å›´é›·æ•°
                cell.textContent = gameState.minefield[y][x];
                cell.classList.add(`number-${gameState.minefield[y][x]}`);
            } else if (gameState.minefield[y][x] === 0) {
                // å¦‚æœæ˜¯ç©ºç™½å•å…ƒæ ¼ï¼Œè‡ªåŠ¨æ­ç¤ºå‘¨å›´
                for (let dy = -1; dy <= 1; dy++) {
                    for (let dx = -1; dx <= 1; dx++) {
                        if (dx !== 0 || dy !== 0) {
                            revealCell(x + dx, y + dy);
                        }
                    }
                }
            }
        }

        // æ¸¸æˆç»“æŸå¤„ç†
        function gameOver(win) {
            gameState.gameOver = true;
            
            // æ­ç¤ºæ‰€æœ‰é›·
            for (let y = 0; y < config.height; y++) {
                for (let x = 0; x < config.width; x++) {
                    if (gameState.minefield[y][x] === -1) {
                        const cell = document.getElementById('minefield').rows[y].cells[x];
                        cell.classList.add('mine');
                    }
                }
            }
            
            setTimeout(() => {
                alert(win ? 'æ­å–œä½ èµ¢äº†ï¼' : 'æ¸¸æˆç»“æŸï¼ä½ è¸©åˆ°é›·äº†ï¼');
            }, 100);
        }

        // æ£€æŸ¥æ˜¯å¦èƒœåˆ©
        function checkWin() {
            let unrevealedSafeCells = 0;
            
            for (let y = 0; y < config.height; y++) {
                for (let x = 0; x < config.width; x++) {
                    if (!gameState.revealed[y][x] && gameState.minefield[y][x] !== -1) {
                        unrevealedSafeCells++;
                    }
                }
            }
            
            return unrevealedSafeCells === 0;
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            if (gameState.firstClick) {
                document.getElementById('mines-left').textContent = config.mines;
                document.getElementById('flags-placed').textContent = '0';
                return;
            }
            
            document.getElementById('mines-left').textContent = config.mines - gameState.flagsPlaced;
            document.getElementById('flags-placed').textContent = gameState.flagsPlaced;
        }
        
        // ç¼©æ”¾æ§åˆ¶
        function zoomIn() {
            if (currentZoom < 2) {
                currentZoom += 0.1;
                updateCellSize();
            }
        }
        
        function zoomOut() {
            if (currentZoom > 0.5) {
                currentZoom -= 0.1;
                updateCellSize();
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        document.getElementById('new-game').addEventListener('click', initGame);
        document.getElementById('zoom-in').addEventListener('click', zoomIn);
        document.getElementById('zoom-out').addEventListener('click', zoomOut);
        
        // åˆå§‹åŒ–è§¦æ‘¸äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('touchmove', function(e) {
            if (e.touches.length === 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        initGame();
    </script>
</body>
</html>